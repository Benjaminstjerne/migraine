<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <title>Elektrisk Storm - Hemiplegisk Migræne Repræsentation</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: black; }
        canvas { display: block; }
    </style>
</head>
<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    // Opretter scene, kamera og renderer
    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 1, 2000 );
    var renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize( window.innerWidth, window.innerHeight );
    document.body.appendChild( renderer.domElement );

    // Variabler til lyn
    var lightningBolts = [];
    var maxBolts = 50; // Øget antal lyn for at fylde skærmen
    var boltLife = 30; // Forlænget levetid for lynene

    // Funktion til at skabe et lyn
    function createLightningBolt() {
        var boltMaterial = new THREE.LineBasicMaterial({ color: 0xffffff });
        var boltGeometry = new THREE.BufferGeometry();
        var positions = [];

        var x = (Math.random() - 0.5) * 800;
        var y = (Math.random() - 0.5) * 800;
        var z = (Math.random() - 0.5) * 800;

        positions.push(x, y, z);

        for (var i = 0; i < 20; i++) {
            x += (Math.random() - 0.5) * 80;
            y += (Math.random() - 0.5) * 80;
            z += (Math.random() - 0.5) * 80;
            positions.push(x, y, z);
        }

        boltGeometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));

        var bolt = new THREE.Line(boltGeometry, boltMaterial);
        bolt.life = boltLife;
        scene.add(bolt);
        lightningBolts.push(bolt);
    }

    // Opretter initiale lyn
    for (var i = 0; i < maxBolts; i++) {
        createLightningBolt();
    }

    camera.position.z = 0.1; // Ændret kamerapositions for at være inde i stormen

    // Animationsloop
    function animate() {
        requestAnimationFrame( animate );

        // Roterer kameraet for at skabe mere dynamisk effekt
        camera.rotation.x += 0.001;
        camera.rotation.y += 0.002;

        // Opdaterer lyn
        for (var i = lightningBolts.length - 1; i >= 0; i--) {
            var bolt = lightningBolts[i];
            bolt.life--;
            if (bolt.life <= 0) {
                scene.remove(bolt);
                lightningBolts.splice(i, 1);
                createLightningBolt();
            }
        }

        renderer.render( scene, camera );
    }
    animate();

    // Fuldskærm ved klik
    document.addEventListener('click', function() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
        }
    });

    // Liste over nøgleord
    var keywords = ['migræne', 'hovedpine', 'lyn', 'smerte', 'storm'];

    // Reagerer på specifikke ord
    if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
        var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
        var recognition = new SpeechRecognition();
        recognition.lang = 'da-DK';
        recognition.continuous = true;
        recognition.interimResults = false;
        recognition.start();

        recognition.onresult = function(event) {
            var transcript = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
            for (var i = 0; i < keywords.length; i++) {
                if (transcript.includes(keywords[i])) {
                    intensifyStorm();
                    break;
                }
            }
        };

        recognition.onerror = function(event) {
            console.error(event.error);
        };
    } else {
        console.log('SpeechRecognition ikke understøttet i denne browser.');
    }

    // Funktion til at intensivere stormen
    function intensifyStorm() {
        maxBolts += 50; // Øger antallet af lyn markant
        for (var i = 0; i < 50; i++) {
            createLightningBolt();
        }

        // Tilføjer en hvid flash for at gøre reaktionen mere tydelig
        flashScreen();
    }

    // Funktion til at skabe en flash-effekt
    function flashScreen() {
        var flash = document.createElement('div');
        flash.style.position = 'absolute';
        flash.style.top = '0';
        flash.style.left = '0';
        flash.style.width = '100%';
        flash.style.height = '100%';
        flash.style.backgroundColor = 'white';
        flash.style.opacity = '0.8';
        flash.style.pointerEvents = 'none';
        document.body.appendChild(flash);

        setTimeout(function() {
            flash.style.transition = 'opacity 0.5s';
            flash.style.opacity = '0';
            setTimeout(function() {
                document.body.removeChild(flash);
            }, 500);
        }, 100);
    }

    // Justerer til vinduets størrelse
    window.addEventListener( 'resize', onWindowResize, false );
    function onWindowResize(){
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( window.innerWidth, window.innerHeight );
    }
</script>

</body>
</html>
